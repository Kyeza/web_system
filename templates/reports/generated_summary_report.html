{% load users_extras %}
{% load reports_extras %}
{% load humanize %}

{% for period, data in results.items %}
    <h4 class="border-top pt-4 mb-2 text-center">
        {{ period.payroll_center }}
    </h4>
    <h5 id="time" class="border-bottom mb-5 text-center">
        PAYROLL FOR THE MONTH OF
        <span  id="{{ period.id }}" class="payroll_period" style="color: #2196F3">{{ period.month }}-{{ period.year }}</span>
    </h5>
    <div class="d-flex flex-row-reverse">
        <div class="p-2">
            <a id="send_mail" class="btn btn-success btn-md" href="#">
                Email PaySlips
            </a>
        </div>
    </div>
    <div class="table-responsive">
        <table id="summary_id" class="table table-sm table-striped table-bordered w-100">
            <thead class="thead-dark">
            <tr>
                <th>No.</th>
                <th>Agresso/Staff ID</th>
                <th>Duty Station</th>
                <th>Category</th>
                <th>Name</th>
                <th>Job Title</th>
                {% for staff in data|get_distinct_employee_set %}
                    {% if forloop.first %}
                        {% for processor in data|user_data_headings:staff|category:1 %}
                            {% for k, heading in processor.items %}
                                <th>{{ heading }}</th>
                            {% endfor %}
                        {% endfor %}
                        {% for processor in data|user_data_headings:staff|category:2 %}
                            {% for k, heading in processor.items %}
                                <th>{{ heading }}</th>
                            {% endfor %}
                        {% endfor %}
                        {% for processor in data|user_data_headings:staff|category:3 %}
                            {% for k, heading in processor.items %}
                                <th>{{ heading }}</th>
                            {% endfor %}
                        {% endfor %}
                    {% endif %}
                {% endfor %}
                <th>Total Deductions</th>
                <th>Net Pay</th>
                <th>Pay Method</th>
            </tr>
            </thead>
            <tbody>
            {% for staff in data|get_distinct_employee_set %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ staff.agresso_number }}</td>
                    <td>{{ staff.duty_station }}</td>
                    <td>{{ staff.category.name }}</td>
                    <td>
                        <a href="{% url 'reports:generate-payslip' period.id staff.pk %}">
                            {{ staff.user.get_full_name }}
                        </a>
                    </td>
                    <td>{{ staff.job_title }}</td>
                    {% for info in data|user_data:staff|category:1 %}
                        <td>{{ info.amount|intcomma }}</td>
                    {% endfor %}
                    {% for info in data|user_data:staff|category:2 %}
                        <td>{{ info.amount|intcomma }}</td>
                    {% endfor %}
                    {% for info in data|user_data:staff|category:3 %}
                        <td>{{ info.amount|intcomma }}</td>
                    {% endfor %}
                    {% with staff|report:period as report %}
                        <td>{{ report.total_deductions|intcomma }}</td>
                        <td>{{ report.net_pay|intcomma }}</td>
                    {% endwith %}
                    <td></td>
                </tr>
            {% endfor %}
            </tbody>
            <tfoot>
            {% for staff in data|get_distinct_employee_set %}
                {% if forloop.first %}
                    <tr>
                        <th colspan="5"></th>
                        <th>Total:</th>
                        {% for info in data|user_data:staff|category:1 %}
                            <th></th>
                        {% endfor %}
                        {% for info in data|user_data:staff|category:2 %}
                            <th></th>
                        {% endfor %}
                        {% for info in data|user_data:staff|category:3 %}
                            <th></th>
                        {% endfor %}
                        <th></th>
                        <th></th>
                        <th></th>
                    </tr>
                {% endif %}
            {% endfor %}
            </tfoot>
        </table>
    </div>
{% endfor %}