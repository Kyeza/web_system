{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block content %}
    <div class="content-section">
        <form id="movementsForm" method="POST" data-user="{{ user_id }}"
              data-movement-url="{% url 'users:ajax_load_current_earning' %}">
            {% csrf_token %}

            <div class="form-group">
                {{ form|crispy }}
                <button class="btn btn-success" type="submit">SUBMIT</button>
                <a class="btn btn-danger" href="{% url 'users:employee_movements_changelist' %}">CANCEL</a>
            </div>
        </form>
    </div>
{% endblock content %}

{% block scripts %}
    <script>
        $("#id_earnings").change(function () {
            let form = $("#movementsForm");
            let url = form.attr('data-movement-url');
            let user_id = form.attr('data-user');
            let earnings_id = $(this).val();

            $.ajax({
                url: url,
                data: {
                    'parameter': earnings_id,
                    'user_id': user_id
                },
                success: function (data) {
                    $("#id_move_from").val(data['amount']);
                    $("#id_extra_info").val(data['payroll_period']);
                }
            });
        })
    </script>
{% endblock scripts %}